<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Institutional Login - PE OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1a3b5b",
                        "navy-custom": "#003366",
                        "background-light": "#f6f7f8",
                        "background-dark": "#13191f",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.15)',
                        'floating': '0 20px 50px -12px rgba(0, 0, 0, 0.15)',
                    }
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .checkbox-custom:checked {
            background-color: #1a3b5b;
            border-color: #1a3b5b;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-[#121417] dark:text-white font-display overflow-hidden">
    <div class="flex h-screen w-full">
        <!-- Left Panel - Branding -->
        <div class="hidden lg:flex w-1/2 relative bg-navy-custom items-center justify-center overflow-hidden">
            <!-- Dot pattern background -->
            <div class="absolute inset-0 z-0 opacity-20" style="background-image: radial-gradient(#ffffff 0.5px, transparent 0.5px); background-size: 24px 24px;"></div>
            <!-- Gradient overlay -->
            <div class="absolute inset-0 bg-gradient-to-tr from-navy-custom via-transparent to-white/10 z-0"></div>

            <div class="relative z-10 flex flex-col items-center w-full px-12">
                <!-- Dashboard Preview Card -->
                <div class="w-full max-w-2xl relative transform transition-all duration-700 hover:scale-[1.01] hover:-translate-y-1">
                    <!-- Glow effect -->
                    <div class="absolute -inset-2 bg-gradient-to-r from-blue-400/30 to-purple-300/20 rounded-xl blur-xl opacity-40"></div>

                    <div class="relative rounded-xl overflow-hidden shadow-2xl border border-white/20 bg-gray-900">
                        <!-- Window controls -->
                        <div class="h-8 bg-gray-800/80 backdrop-blur border-b border-white/10 flex items-center px-4 space-x-2">
                            <div class="w-3 h-3 rounded-full bg-red-400"></div>
                            <div class="w-3 h-3 rounded-full bg-amber-400"></div>
                            <div class="w-3 h-3 rounded-full bg-green-400"></div>
                        </div>
                        <!-- Dashboard preview image -->
                        <div class="aspect-[16/9] w-full bg-cover bg-top"
                             data-alt="Abstract dashboard interface showing financial charts and data grids"
                             style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCBNCbszYSGBSBmNCcjzumoDSILVtW-BhoJlf_z705apNW50JLQ6e79F23pCV9Jm1pAGwlU0V5FcD5BkIeJP8rrX5m8HPNr1dc4CU_QBLfWEYGq6maAyRjWPHsToea1tp3lt5SMbRglDG85Eq98sq_hbKseCEKSEU8aCF7UI9eVoH_7QCSTqOriixXyQeBoH0nyO3yOL_R51FeuLqVDklLNa5JXcimcN9ddpRO6bt4o6fWO110Pv8X--7rRnl9Kfk7gCr9VJTrP35A");'>
                            <div class="absolute inset-0 bg-navy-custom/10 mix-blend-overlay"></div>
                        </div>
                    </div>
                </div>

                <!-- Tagline -->
                <div class="mt-12 text-center space-y-3">
                    <h2 class="text-3xl font-semibold text-white tracking-tight">The Operating System for Modern Capital</h2>
                    <p class="text-blue-100/80 text-base max-w-md mx-auto leading-relaxed">
                        Unified intelligence for private equity.
                        Streamline your deal flow and portfolio monitoring in one secure environment.
                    </p>
                </div>
            </div>
        </div>

        <!-- Right Panel - Login Form -->
        <div class="w-full lg:w-1/2 flex flex-col justify-center items-center bg-white dark:bg-background-dark px-6 md:px-12 lg:px-24 relative">
            <!-- Mobile background gradient -->
            <div class="absolute inset-0 lg:hidden pointer-events-none opacity-5 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary via-transparent to-transparent"></div>

            <div class="w-full max-w-[440px] z-10">
                <!-- Logo -->
                <div class="flex items-center gap-2 mb-10">
                    <div class="w-8 h-8 rounded bg-primary flex items-center justify-center text-white">
                        <span class="material-symbols-outlined text-[20px]">candlestick_chart</span>
                    </div>
                    <span class="text-xl font-bold tracking-tight text-primary dark:text-white">PE<span class="font-light opacity-80">OS</span></span>
                </div>

                <!-- Header -->
                <div class="mb-8">
                    <h1 class="text-[#121417] dark:text-white tracking-tight text-[28px] font-bold leading-tight text-left mb-2">Sign in to your account</h1>
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-normal">Welcome back! Please enter your details.</p>
                </div>

                <!-- Login Form -->
                <form id="loginForm" class="flex flex-col gap-5">
                    <!-- Email Field -->
                    <label class="flex flex-col gap-1.5">
                        <p class="text-[#121417] dark:text-gray-200 text-sm font-medium leading-normal">Business Email</p>
                        <input
                            id="email"
                            autocomplete="email"
                            class="form-input flex w-full rounded-lg text-[#121417] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/20 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800/50 focus:border-primary h-12 placeholder:text-gray-400 px-4 text-sm font-normal transition-all"
                            placeholder="name@firm.com"
                            type="email"
                            required
                        />
                    </label>

                    <!-- Password Field -->
                    <label class="flex flex-col gap-1.5">
                        <p class="text-[#121417] dark:text-gray-200 text-sm font-medium leading-normal">Password</p>
                        <div class="relative flex w-full rounded-lg group focus-within:ring-2 focus-within:ring-primary/20 focus-within:border-primary border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800/50 transition-all">
                            <input
                                id="password"
                                class="form-input flex-1 min-w-0 border-none bg-transparent h-12 text-[#121417] dark:text-white placeholder:text-gray-400 px-4 text-sm font-normal focus:ring-0"
                                placeholder="••••••••"
                                type="password"
                                required
                            />
                            <div class="pr-3 flex items-center justify-center text-gray-400 group-focus-within:text-primary">
                                <span id="togglePassword" class="material-symbols-outlined cursor-pointer hover:text-primary transition-colors text-[20px]">visibility_off</span>
                            </div>
                        </div>
                    </label>

                    <!-- Remember Me & Forgot Password -->
                    <div class="flex justify-between items-center">
                        <label class="flex items-center gap-2 cursor-pointer group">
                            <input
                                id="rememberMe"
                                class="checkbox-custom rounded border-gray-300 text-primary focus:ring-primary/20 w-4 h-4 transition-all cursor-pointer"
                                type="checkbox"
                            />
                            <span class="text-sm text-slate-600 dark:text-slate-400 group-hover:text-slate-800 dark:group-hover:text-slate-300 transition-colors">Remember me</span>
                        </label>
                        <a class="text-primary hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium transition-colors" href="#">Forgot password?</a>
                    </div>

                    <!-- Sign In Button -->
                    <button
                        id="signInBtn"
                        class="w-full bg-primary hover:bg-[#15304a] text-white font-medium rounded-lg h-12 shadow-sm transition-all duration-200 flex items-center justify-center gap-2 mt-2 disabled:opacity-50 disabled:cursor-not-allowed"
                        type="submit"
                    >
                        <span id="signInText">Sign In</span>
                        <span id="signInIcon" class="material-symbols-outlined text-[18px]">arrow_forward</span>
                        <span id="signInSpinner" class="hidden">
                            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </span>
                    </button>

                    <!-- Error Message -->
                    <div id="errorMessage" class="hidden text-red-500 text-sm text-center bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"></div>

                    <!-- Divider -->
                    <div class="relative flex py-2 items-center">
                        <div class="flex-grow border-t border-gray-200 dark:border-gray-700"></div>
                        <span class="flex-shrink-0 mx-4 text-xs text-gray-400 font-medium uppercase tracking-wider">Or continue with</span>
                        <div class="flex-grow border-t border-gray-200 dark:border-gray-700"></div>
                    </div>

                    <!-- SSO Button -->
                    <button
                        class="w-full bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-[#121417] dark:text-white border border-gray-200 dark:border-gray-700 font-medium rounded-lg h-12 transition-all duration-200 flex items-center justify-center gap-3"
                        type="button"
                        onclick="handleSSO()"
                    >
                        <span class="material-symbols-outlined text-primary dark:text-white text-[20px]">lock_person</span>
                        <span>Single Sign-On (SSO)</span>
                    </button>

                    <!-- Sign Up Link -->
                    <div class="text-center mt-2">
                        <p class="text-sm text-slate-500">
                            Don't have an account?
                            <a class="text-primary hover:text-blue-700 font-medium transition-colors" href="signup.html">Sign up</a>
                        </p>
                    </div>
                </form>

                <!-- Footer -->
                <div class="mt-10 pt-6 border-t border-gray-100 dark:border-gray-800 flex items-center justify-center text-xs text-slate-400">
                    <p>© 2024 PE OS Inc.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <!-- Auth Helper -->
    <script src="js/auth.js"></script>

    <script>
        // Password visibility toggle
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');

        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.textContent = type === 'password' ? 'visibility_off' : 'visibility';
        });

        // Form submission
        const loginForm = document.getElementById('loginForm');
        const signInBtn = document.getElementById('signInBtn');
        const signInText = document.getElementById('signInText');
        const signInIcon = document.getElementById('signInIcon');
        const signInSpinner = document.getElementById('signInSpinner');
        const errorMessage = document.getElementById('errorMessage');

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            // Show loading state
            signInBtn.disabled = true;
            signInText.textContent = 'Signing in...';
            signInIcon.classList.add('hidden');
            signInSpinner.classList.remove('hidden');
            errorMessage.classList.add('hidden');

            try {
                // Sign in with Supabase
                const { user, session, error } = await PEAuth.signIn(email, password);

                if (error) {
                    throw error;
                }

                if (user && session) {
                    // Get redirect destination or default to CRM
                    const redirect = sessionStorage.getItem('authRedirect') || 'crm.html';
                    sessionStorage.removeItem('authRedirect');
                    window.location.href = redirect;
                } else {
                    throw new Error('Authentication failed');
                }
            } catch (error) {
                // Show error message
                let message = 'Invalid email or password. Please try again.';
                if (error.message) {
                    if (error.message.includes('Invalid login credentials')) {
                        message = 'Invalid email or password. Please try again.';
                    } else if (error.message.includes('Email not confirmed')) {
                        message = 'Please verify your email address before signing in.';
                    } else {
                        message = error.message;
                    }
                }
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
            } finally {
                // Reset button state
                signInBtn.disabled = false;
                signInText.textContent = 'Sign In';
                signInIcon.classList.remove('hidden');
                signInSpinner.classList.add('hidden');
            }
        });

        // SSO handler
        function handleSSO() {
            alert('SSO integration would be configured here.\n\nThis would typically redirect to your identity provider (Okta, Azure AD, etc.)');
        }

        // Check for existing session on page load
        document.addEventListener('DOMContentLoaded', async function() {
            // Force light mode
            document.documentElement.classList.remove('dark');

            // Initialize auth and check if already logged in
            await PEAuth.initSupabase();
            const notAuth = await PEAuth.checkNotAuth();
            // If user is authenticated, checkNotAuth will redirect to CRM
        });
    </script>
</body>
</html>
