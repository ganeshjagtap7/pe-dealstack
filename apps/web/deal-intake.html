<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Deal Intake - PE OS</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    "primary": "#003366",
                    "primary-hover": "#002855",
                    "primary-light": "#E6EEF5",
                    "secondary": "#059669",
                    "secondary-light": "#D1FAE5",
                    "background-body": "#F8F9FA",
                    "surface-card": "#FFFFFF",
                    "border-subtle": "#E5E7EB",
                    "border-focus": "#CBD5E1",
                    "text-main": "#111827",
                    "text-secondary": "#4B5563",
                    "text-muted": "#9CA3AF",
                },
                fontFamily: {
                    "sans": ["Inter", "sans-serif"],
                    "display": ["Inter", "sans-serif"],
                },
                boxShadow: {
                    "card": "0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px -1px rgba(0, 0, 0, 0.05)",
                    "card-hover": "0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -4px rgba(0, 0, 0, 0.05)",
                    "glow": "0 0 15px rgba(0, 51, 102, 0.1)",
                },
                borderRadius: {
                    "DEFAULT": "0.5rem",
                    "md": "0.375rem",
                    "lg": "0.5rem",
                    "xl": "0.75rem",
                }
            },
        },
    }
</script>
</head>
<body class="bg-background-body text-text-main font-sans overflow-hidden">
<div class="flex h-screen w-full overflow-hidden">
<!-- Sidebar (injected by layout.js) -->
<div id="sidebar-root"></div>

<!-- Main Content -->
<main class="flex h-full flex-1 flex-col overflow-hidden bg-background-body">
<!-- Header (injected by layout.js) -->
<div id="header-root"></div>

<!-- Deal Intake Content -->
<div class="flex-1 overflow-y-auto p-6 custom-scrollbar">
<div class="mx-auto max-w-3xl flex flex-col gap-6">

<!-- Page Header -->
<div class="flex flex-col gap-1">
<h1 class="text-2xl font-bold text-text-main tracking-tight font-display">Deal Intake</h1>
<p class="text-text-secondary text-sm">Upload a document, paste text, or enter a company URL to create a new deal.</p>
</div>

<!-- Tab Navigation -->
<div class="flex gap-1 bg-gray-100 rounded-lg p-1">
<button id="tab-upload" class="tab-btn flex-1 flex items-center justify-center gap-2 py-2.5 px-4 rounded-md text-sm font-medium transition-all bg-white text-primary shadow-sm" onclick="switchTab('upload')">
<span class="material-symbols-outlined text-[18px]">upload_file</span>
Upload File
</button>
<button id="tab-text" class="tab-btn flex-1 flex items-center justify-center gap-2 py-2.5 px-4 rounded-md text-sm font-medium transition-all text-text-secondary hover:text-text-main" onclick="switchTab('text')">
<span class="material-symbols-outlined text-[18px]">edit_note</span>
Paste Text
</button>
<button id="tab-url" class="tab-btn flex-1 flex items-center justify-center gap-2 py-2.5 px-4 rounded-md text-sm font-medium transition-all text-text-secondary hover:text-text-main" onclick="switchTab('url')">
<span class="material-symbols-outlined text-[18px]">language</span>
Enter URL
</button>
</div>

<!-- Upload File Tab -->
<div id="panel-upload" class="tab-panel">
<div class="rounded-lg border border-border-subtle bg-surface-card p-6 shadow-card">
<div id="drop-zone" class="relative flex flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed border-border-subtle p-10 hover:border-primary/50 hover:bg-primary-light/30 transition-all cursor-pointer">
<span class="material-symbols-outlined text-4xl text-text-muted">cloud_upload</span>
<div class="text-center">
<p class="text-sm font-medium text-text-main">Drag & drop a file here, or <span class="text-primary font-semibold">browse</span></p>
<p class="text-xs text-text-muted mt-1">PDF, Word (.docx, .doc), Excel (.xlsx), or Text (.txt) â€” Max 50MB</p>
</div>
<input id="file-input" type="file" class="absolute inset-0 opacity-0 cursor-pointer" accept=".pdf,.docx,.doc,.xlsx,.xls,.txt,.csv" />
</div>
<div id="file-info" class="hidden mt-4 flex items-center gap-3 rounded-lg bg-primary-light/50 border border-primary/20 px-4 py-3">
<span class="material-symbols-outlined text-primary">description</span>
<div class="flex-1 min-w-0">
<p id="file-name" class="text-sm font-medium text-text-main truncate"></p>
<p id="file-size" class="text-xs text-text-muted"></p>
</div>
<button onclick="clearFile()" class="p-1 rounded hover:bg-white/50 text-text-muted hover:text-red-500 transition-colors">
<span class="material-symbols-outlined text-[18px]">close</span>
</button>
</div>
<button id="upload-btn" onclick="uploadFile()" disabled class="mt-4 w-full py-2.5 px-4 rounded-lg bg-primary text-white text-sm font-medium hover:bg-primary-hover disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-[18px]">auto_awesome</span>
Extract & Create Deal
</button>
</div>
</div>

<!-- Paste Text Tab -->
<div id="panel-text" class="tab-panel hidden">
<div class="rounded-lg border border-border-subtle bg-surface-card p-6 shadow-card">
<label class="block text-sm font-medium text-text-main mb-2">Paste deal information</label>
<textarea id="text-input" rows="10" class="w-full rounded-lg border border-border-subtle bg-white px-4 py-3 text-sm text-text-main placeholder-text-muted focus:border-primary focus:ring-1 focus:ring-primary/30 transition-colors resize-none" placeholder="Paste deal memo, email, CIM summary, or any text containing company and financial information...&#10;&#10;Example:&#10;Acme Healthcare Services is a leading home healthcare provider in the Northeast US with $150M revenue and $30M EBITDA..."></textarea>
<div class="flex items-center justify-between mt-2">
<p class="text-xs text-text-muted"><span id="text-char-count">0</span> characters (minimum 50)</p>
<div class="flex gap-2">
<select id="text-source-type" class="rounded-md border border-border-subtle bg-white px-3 py-1.5 text-xs text-text-secondary focus:border-primary focus:ring-1 focus:ring-primary/30">
<option value="other">Source: Other</option>
<option value="email">Email</option>
<option value="note">Note</option>
<option value="slack">Slack</option>
<option value="whatsapp">WhatsApp</option>
</select>
</div>
</div>
<button id="text-btn" onclick="extractFromText()" disabled class="mt-4 w-full py-2.5 px-4 rounded-lg bg-primary text-white text-sm font-medium hover:bg-primary-hover disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-[18px]">auto_awesome</span>
Extract & Create Deal
</button>
</div>
</div>

<!-- Enter URL Tab -->
<div id="panel-url" class="tab-panel hidden">
<div class="rounded-lg border border-border-subtle bg-surface-card p-6 shadow-card">
<label class="block text-sm font-medium text-text-main mb-2">Company website URL</label>
<div class="flex gap-3">
<div class="relative flex-1">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-[18px]">link</span>
<input id="url-input" type="url" class="w-full rounded-lg border border-border-subtle bg-white pl-10 pr-4 py-2.5 text-sm text-text-main placeholder-text-muted focus:border-primary focus:ring-1 focus:ring-primary/30 transition-colors" placeholder="https://www.example.com" />
</div>
</div>
<label class="block text-sm font-medium text-text-main mt-4 mb-2">Company name <span class="text-text-muted font-normal">(optional override)</span></label>
<input id="url-company-name" type="text" class="w-full rounded-lg border border-border-subtle bg-white px-4 py-2.5 text-sm text-text-main placeholder-text-muted focus:border-primary focus:ring-1 focus:ring-primary/30 transition-colors" placeholder="e.g. Acme Healthcare" />
<button id="url-btn" onclick="extractFromURL()" disabled class="mt-4 w-full py-2.5 px-4 rounded-lg bg-primary text-white text-sm font-medium hover:bg-primary-hover disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-[18px]">auto_awesome</span>
Scrape & Create Deal
</button>
</div>
</div>

<!-- Loading State -->
<div id="loading-state" class="hidden">
<div class="rounded-lg border border-primary/20 bg-primary-light/30 p-8 shadow-card text-center">
<div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-primary/10 mb-4">
<span class="material-symbols-outlined text-primary text-2xl animate-spin">progress_activity</span>
</div>
<p class="text-sm font-medium text-text-main">Extracting deal data...</p>
<p class="text-xs text-text-secondary mt-1">AI is analyzing the content and extracting company information</p>
</div>
</div>

<!-- Error State -->
<div id="error-state" class="hidden">
<div class="rounded-lg border border-red-200 bg-red-50 p-5 shadow-card">
<div class="flex items-start gap-3">
<span class="material-symbols-outlined text-red-500 mt-0.5">error</span>
<div class="flex-1">
<p class="text-sm font-medium text-red-800" id="error-title">Extraction failed</p>
<p class="text-xs text-red-600 mt-1" id="error-message"></p>
</div>
<button onclick="hideError()" class="p-1 rounded hover:bg-red-100 text-red-400 hover:text-red-600 transition-colors">
<span class="material-symbols-outlined text-[18px]">close</span>
</button>
</div>
</div>
</div>

<!-- Extraction Preview -->
<div id="extraction-preview" class="hidden">
<div class="rounded-lg border border-secondary/30 bg-surface-card p-6 shadow-card">
<div class="flex items-center justify-between mb-5">
<div class="flex items-center gap-2">
<span class="material-symbols-outlined text-secondary">check_circle</span>
<h2 class="text-lg font-bold text-text-main">Deal Created</h2>
</div>
<div id="review-badge" class="hidden px-2.5 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs font-medium flex items-center gap-1">
<span class="material-symbols-outlined text-[14px]">warning</span>
Needs Review
</div>
</div>

<!-- Extracted Fields -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="col-span-full">
<div class="flex items-center justify-between mb-1">
<span class="text-xs font-medium text-text-secondary">Company Name</span>
<span id="conf-company" class="text-xs font-medium"></span>
</div>
<p id="val-company" class="text-sm font-semibold text-text-main"></p>
<div class="w-full bg-gray-100 h-1.5 mt-1.5 rounded-full overflow-hidden">
<div id="bar-company" class="h-1.5 rounded-full transition-all" style="width: 0%"></div>
</div>
</div>

<div>
<div class="flex items-center justify-between mb-1">
<span class="text-xs font-medium text-text-secondary">Industry</span>
<span id="conf-industry" class="text-xs font-medium"></span>
</div>
<p id="val-industry" class="text-sm text-text-main"></p>
<div class="w-full bg-gray-100 h-1.5 mt-1.5 rounded-full overflow-hidden">
<div id="bar-industry" class="h-1.5 rounded-full transition-all" style="width: 0%"></div>
</div>
</div>

<div>
<div class="flex items-center justify-between mb-1">
<span class="text-xs font-medium text-text-secondary">Overall Confidence</span>
<span id="conf-overall" class="text-xs font-medium"></span>
</div>
<p id="val-overall" class="text-sm text-text-main"></p>
<div class="w-full bg-gray-100 h-1.5 mt-1.5 rounded-full overflow-hidden">
<div id="bar-overall" class="h-1.5 rounded-full transition-all" style="width: 0%"></div>
</div>
</div>

<div>
<div class="flex items-center justify-between mb-1">
<span class="text-xs font-medium text-text-secondary">Revenue</span>
<span id="conf-revenue" class="text-xs font-medium"></span>
</div>
<p id="val-revenue" class="text-sm text-text-main"></p>
<div class="w-full bg-gray-100 h-1.5 mt-1.5 rounded-full overflow-hidden">
<div id="bar-revenue" class="h-1.5 rounded-full transition-all" style="width: 0%"></div>
</div>
</div>

<div>
<div class="flex items-center justify-between mb-1">
<span class="text-xs font-medium text-text-secondary">EBITDA</span>
<span id="conf-ebitda" class="text-xs font-medium"></span>
</div>
<p id="val-ebitda" class="text-sm text-text-main"></p>
<div class="w-full bg-gray-100 h-1.5 mt-1.5 rounded-full overflow-hidden">
<div id="bar-ebitda" class="h-1.5 rounded-full transition-all" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Review Reasons -->
<div id="review-reasons" class="hidden mt-4 p-3 rounded-lg bg-yellow-50 border border-yellow-200">
<p class="text-xs font-medium text-yellow-800 mb-1">Review needed:</p>
<ul id="review-reasons-list" class="text-xs text-yellow-700 list-disc list-inside"></ul>
</div>

<!-- Actions -->
<div class="flex gap-3 mt-5">
<button id="view-deal-btn" onclick="goToDeal()" class="flex-1 py-2.5 px-4 rounded-lg bg-primary text-white text-sm font-medium hover:bg-primary-hover transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-[18px]">open_in_new</span>
View Deal
</button>
<button onclick="resetForm()" class="py-2.5 px-4 rounded-lg border border-border-subtle text-text-secondary text-sm font-medium hover:bg-gray-50 transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-[18px]">add</span>
Add Another
</button>
</div>
</div>
</div>

</div>
</div>
</main>
</div>

<!-- Load shared layout -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="js/auth.js"></script>
<script src="js/layout.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async function() {
        await PEAuth.initSupabase();
        const auth = await PEAuth.checkAuth();
        if (!auth) return;

        PELayout.init('deal-intake', { collapsible: true });
    });
</script>
<script src="js/deal-intake.js"></script>
</body></html>
